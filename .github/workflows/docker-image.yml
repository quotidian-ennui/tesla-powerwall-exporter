name: docker-image

on:
  workflow_call:

jobs:
  docker-build-image:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4.1.1
      with:
        fetch-depth: 0
    - name: Set up JDK
      uses: actions/setup-java@v4.0.0
      with:
        java-version: 21
        distribution: 'temurin'
    - name: Gradle Build
      uses: gradle/gradle-build-action@v2.11.0
      id: gradle
      with:
        gradle-version: wrapper
        arguments: build
    - name: docker-build-push
      uses: quotidian-ennui/actions-olio/docker-image-builder@main
      with:
        registry_push: true
        dockerfile: ./src/main/docker/Dockerfile.jvm
        image_platforms: linux/amd64,linux/arm64/v8
        ghcr_image_name: ghcr.io/${{ github.repository }}
        ghcr_user: ${{ github.repository_owner }}
        ghcr_token: ${{ secrets.GITHUB_TOKEN }}
